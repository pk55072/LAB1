const data = {
    "website": "Voće",
    "categories": [
        { 
            "name" : "Brazilsko voće",
            "image" : "../images/brazil/brazilflag.jpg",
            "categoryNumber" : 1,
            "products" : [
                { 
                    "name" : "Brazilski orasi", "image" : "../images/brazil/brazil-nuts.jpg"
                },
                { 
                    "name" : "Cashew voće", "image" : "../images/brazil/cashew-fruit.jpg"
                },
                { 
                    "name" : "Jaboticaba", "image" : "../images/brazil/jaboticaba.jpg"
                },
                { 
                    "name" : "Pitanga", "image" : "../images/brazil/pitanga.jpg"
                },
                { 
                    "name" : "Sapote", "image" : "../images/brazil/sapote.jpg"
                }
            ]
        },
        { 
            "name" : "Egipatsko voće",
            "image" : "../images/egipat/egyptflag.jpg",
            "categoryNumber" : 2,
            "products" : [
                { 
                    "name" : "Chirimoya", "image" : "../images/egipat/chirimoya.jpg"
                },
                { 
                    "name" : "Loquat", "image" : "../images/egipat/loquat.jpg"
                },
                { 
                    "name" : "Persimmons", "image" : "../images/egipat/persimmons.jpg"
                },
                { 
                    "name" : "Nar", "image" : "../images/egipat/pomegranate-nar.jpg"
                },
                { 
                    "name" : "Bodljikava kruška", "image" : "../images/egipat/prickly-pear.jpg"
                },
                { 
                    "name" : "Egipatske smokve", "image" : "../images/egipat/smokve-egipat.jpg"
                },
                { 
                    "name" : "Smokve Sycamore", "image" : "../images/egipat/sycamore-fig.jpg"
                }
            ]
        },
        { 
            "name" : "Filipinsko voće",
            "image" : "../images/filipini/philippinesflag.jpg",
            "categoryNumber" : 3,
            "products" : [
                { 
                    "name" : "Durian", "image" : "../images/filipini/durian.jpg"
                },
                { 
                    "name" : "Jackfruit", "image" : "../images/filipini/jack-fruit.jpg"
                },
                { 
                    "name" : "Lanzones", "image" : "../images/filipini/lanzones.jpg"
                },
                { 
                    "name" : "Mango", "image" : "../images/filipini/mango.jpg"
                },
                { 
                    "name" : "Mangosteen", "image" : "../images/filipini/mangosteen.jpg"
                }
            ]
        },
        { 
            "name" : "Indijsko voće",
            "image" : "../images/indija/indiaflag.jpg",
            "categoryNumber" : 4,
            "products" : [
                { 
                    "name" : "Mango", "image" : "../images/indija/mango.jpg"
                },
                { 
                    "name" : "Jackfruit", "image" : "../images/indija/jack-fruit.jpg"
                },
                { 
                    "name" : "Liči", "image" : "../images/indija/lychee.jpg"
                },
                { 
                    "name" : "Starfruit", "image" : "../images/indija/starfruit.jpg"
                },
                { 
                    "name" : "Tamarind", "image" : "../images/indija/Tamarind.jpg"
                }
            ]
        },
        { 
            "name" : "Indonezijsko voće",
            "image" : "../images/indonezija/indonesiaflag.jpg",
            "categoryNumber" : 5,
            "products" : [
                { 
                    "name" : "Mangosteen", "image" : "../images/indonezija/mangosteen.jpg"
                },
                { 
                    "name" : "Durian", "image" : "../images/indonezija/durian.jpg"
                },
                { 
                    "name" : "Langsat", "image" : "../images/indonezija/langsat.jpg"
                },
                { 
                    "name" : "Breadfruit", "image" : "../images/indonezija/breadfruit.jpg"
                },
                { 
                    "name" : "Rambutan", "image" : "../images/indonezija/rambutan.jpg"
                },
                { 
                    "name" : "Zmijsko voće", "image" : "../images/indonezija/salak.jpg"
                }
            ]
        },
        { 
            "name" : "Japansko voće",
            "image" : "../images/japan/japanflag.jpg",
            "categoryNumber" : 6,
            "products" : [
                { 
                    "name" : "Dekopon", "image" : "../images/japan/dekopon.jpg"
                },
                { 
                    "name" : "Nashi kruška", "image" : "../images/japan/nashi-pear.jpg"
                },                
                { 
                    "name" : "Persimmons", "image" : "../images/japan/persimmons.jpg"
                },
                { 
                    "name" : "Shinnano zlatna jabuka", "image" : "../images/japan/shinnano-gold-apple.jpg"
                },
                { 
                    "name" : "Yubari king melon", "image" : "../images/japan/yubari-king-melon.jpg"
                },
                { 
                    "name" : "Yuzu", "image" : "../images/japan/yuzu.jpg"
                }
            ]
        },
        { 
            "name" : "Kolumbijsko voće",
            "image" : "../images/kolumbija/colombiaflag.jpg",
            "categoryNumber" : 7,
            "products" : [
                { 
                    "name" : "Granadilla", "image" : "../images/kolumbija/granadilla.jpg"
                },
                { 
                    "name" : "Guanabana", "image" : "../images/kolumbija/guanabana.jpg"
                },
                { 
                    "name" : "Marakuja", "image" : "../images/kolumbija/maracuya.jpg"
                },
                { 
                    "name" : "Naranjilla", "image" : "../images/kolumbija/naranjilla.jpg"
                },
                { 
                    "name" : "Pitahaya", "image" : "../images/kolumbija/pitahaya.jpg"
                },
                { 
                    "name" : "Uchuva", "image" : "../images/kolumbija/uchuva.jpg"
                },
            ]
        },
        { 
            "name" : "Meksičko voće",
            "image" : "../images/meksiko/mexicoflag.jpg",
            "categoryNumber" : 8,
            "products" : [
                { 
                    "name" : "Guanabana", "image" : "../images/meksiko/guanabana.jpg"
                },
                { 
                    "name" : "Chirimoya", "image" : "../images/meksiko/chirimoya.jpg"
                },
                { 
                    "name" : "Guava", "image" : "../images/meksiko/guava.jpg"
                },
                { 
                    "name" : "Mamey-sapote", "image" : "../images/meksiko/mamey.jpg"
                },
                { 
                    "name" : "Papaja", "image" : "../images/meksiko/papaya.jpg"
                },
                {
                    "name" : "Kaktus kruške", "image" : "../images/meksiko/prickly-pear.jpg"
                }
            ]
        },
        { 
            "name" : "Tajlandsko voće",
            "image" : "../images/tajland/thailand.jpg",
            "categoryNumber" : 9,
            "products" : [
                { 
                    "name" : "Zmajevo voće", "image" : "../images/tajland/dragonfruit.jpg"
                },
                { 
                    "name" : "Mangosteen", "image" : "../images/tajland/mangosteen.jpg"
                },
                { 
                    "name" : "Durian", "image" : "../images/tajland/durian.jpg"
                },
                { 
                    "name" : "Rambutan", "image" : "../images/tajland/rambutan.jpg"
                },
                { 
                    "name" : "Zmijsko voće", "image" : "../images/tajland/salak.jpg"
                },
                {
                    "name" : "jackfruit", "image" : "../images/tajland/jack-fruit.jpg"
                }
            ]
        },
        { 
            "name" : "Vijetnamsko voće",
            "image" : "../images/vijetnam/vietnamflag.jpg",
            "categoryNumber" : 10,
            "products" : [
                { 
                    "name" : "Longan", "image" : "../images/vijetnam/longan.jpg"
                },
                { 
                    "name" : "Liči", "image" : "../images/vijetnam/lychee.jpg"
                },
                { 
                    "name" : "Mango", "image" : "../images/vijetnam/mango.jpg"
                },
                { 
                    "name" : "Pitahaya", "image" : "../images/vijetnam/pitahaya.jpg"
                },
                { 
                    "name" : "Pomelo", "image" : "../images/vijetnam/pomelo.jpg"
                },
                { 
                    "name" : "Rambutan", "image" : "../images/vijetnam/rambutan.jpg"
                }
            ]
        },
    ]
}

function isLaptopView() {
    return window.matchMedia("(max-width: 1024px)").matches;
}

let currentCategory = 'Brazilsko voće';
function setCurrentCategory(categoryName) {
    currentCategory = categoryName;
    localStorage.setItem('currentCategory', categoryName);
}

function initializePage() { // Napravio sam ovakav reset da se košarica reseta svaki reload stranice
    
   
    setCurrentCategory('Brazilsko voće');
    if (isLaptopView()) {
        renderLaptop();
    } else {
        renderDesktop();
    }
    updateCartBadges();
    if (performance.navigation.type === PerformanceNavigation.TYPE_RELOAD) {
        
    } else {
        localStorage.clear();
    }
}

function renderDesktop() {
    
    const categoriesContainer = document.querySelector('.div4');
    let categoriesHTML = '<div class="categories-list">';
    data.categories.forEach(category => {
        categoriesHTML += `
            <div class="category-item" onclick="showCategory('${category.name}')">
                ${category.name}
            </div>
        `;
    });
    categoriesHTML += '</div>';
    categoriesContainer.innerHTML = categoriesHTML;
    const savedCategory = localStorage.getItem('currentCategory');
    if (savedCategory) currentCategory = savedCategory;
    showCategory(currentCategory);
}

function renderLaptop() {
    const categoriesContainer = document.querySelector('.parent-laptop .div6');
    let categoriesHTML = '<div class="categories-list">';
    data.categories.forEach(category => {
        categoriesHTML += `
            <div class="category-item" onclick="showCategoryLaptop('${category.name}')">
                ${category.name}
            </div>
        `;
    });
    categoriesHTML += '</div>';
    categoriesContainer.innerHTML = categoriesHTML;
    const savedCategory = localStorage.getItem('currentCategory');
    if (savedCategory) currentCategory = savedCategory;
    showCategoryLaptop(currentCategory);
}

function showCategory(categoryName) {
    setCurrentCategory(categoryName)
    const category = data.categories.find(c => c.name === categoryName);
    
    const activeCategoryContainer = document.querySelector('.div2');
    activeCategoryContainer.textContent = category.name;
    document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
        if(item.textContent === categoryName) item.classList.add('active');
    });

    
    const productsContainer = document.querySelector('.div8');
    let productsHTML = '<div class="products-grid">';
    
    category.products.forEach(product => {
      
        const countryFolder = category.name.toLowerCase().replace(/(sko voće|čko voće)$/, '').trim();
        productsHTML += `
                <div class="product-card" data-id="${product.name.toLowerCase().replace(/\s+/g, '-')}">
                    <div class="product-image-wrapper">
                     <img src="./images/${countryFolder}/${product.image.split('/').pop()}" 
                            alt="${product.name}" 
                                class="product-image">
                        <button class="cart-icon-btn" onclick="addToCart('${product.name.toLowerCase().replace(/\s+/g, '-')}', '${product.name}')">
                            <img src="./images/shopping-cart-icon.png" width="16">
                        </button>
                            <span class="cart-badge" id="badge-${product.name.toLowerCase().replace(/\s+/g, '-')}"></span>
                    </div>
                    <p class="product-name">${product.name}</p>
                </div>
            `;
    });
    
    productsHTML += '</div>';
    productsContainer.innerHTML = productsHTML;
}

function showCategoryLaptop(categoryName) {
    setCurrentCategory(categoryName)
    const category = data.categories.find(c => c.name === categoryName);
    
    const activeCategoryContainer = document.querySelector('.div2');
    activeCategoryContainer.textContent = category.name;
    document.querySelectorAll('.parent-laptop .category-item').forEach(item => {
        item.classList.remove('active');
        if(item.textContent === categoryName) item.classList.add('active');
    });

    
    const productsContainer = document.querySelector('.parent-laptop .div8');
    let productsHTML = '<div class="products-grid">';
    category.products.forEach(product => {
        const countryFolder = category.name.toLowerCase().replace(/(sko voće|čko voće)$/, '').trim();
        productsHTML += `
                <div class="product-card" data-id="${product.name.toLowerCase().replace(/\s+/g, '-')}">
                    <div class="product-image-wrapper">
                        <img src="./images/${countryFolder}/${product.image.split('/').pop()}" 
                            alt="${product.name}" 
                                class="product-image">
                        <button class="cart-icon-btn" onclick="addToCart('${product.name.toLowerCase().replace(/\s+/g, '-')}', '${product.name}')">
                            <img src="./images/shopping-cart-icon.png" width="16">
                        </button>
                            <span class="cart-badge" id="badge-${product.name.toLowerCase().replace(/\s+/g, '-')}"></span>
                    </div>
                    <p class="product-name">${product.name}</p>
                </div>
            `;
    });
    productsHTML += '</div>';
    productsContainer.innerHTML = productsHTML;
}
window.addEventListener('resize', () => {
    if (isLaptopView()) {
        renderLaptop();
    } else {
        renderDesktop();
    }
});
window.onload = initializePage;



function getCart() {
    return JSON.parse(localStorage.getItem('cart') || '{}');
  }
  
  function setCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
  }
  
  function updateCartBadges() {
    const cart = getCart();
    let total = 0;
    for (const id in cart) {
      const count = cart[id].qty;
      total += count;
      const badge = document.getElementById('badge-' + id);
      if (badge) {
        badge.textContent = count;
        badge.classList.toggle('active', count > 0);
      }
    }
    
    const headerBadge = document.getElementById('cart-badge-header');
    if (headerBadge) {
      headerBadge.textContent = total;
      headerBadge.style.display = total ? 'inline-block' : 'none';
    }
  }
  
  function addToCart(productId, productName) {
    const cart = getCart();
    if (!cart[productId]) cart[productId] = { name: productName, qty: 0 };
    cart[productId].qty += 1;
    setCart(cart);
    updateCartBadges();
  }

  document.addEventListener('DOMContentLoaded', updateCartBadges);